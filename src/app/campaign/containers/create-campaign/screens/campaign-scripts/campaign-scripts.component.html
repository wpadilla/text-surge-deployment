<div class="my-5 d-flex flex-column">
  <b>Va Dems</b>
  <h1>Justin Case for Governor 2021</h1>
</div>
<form #scriptForm [formGroup]="form" (ngSubmit)="submitForm()" [generateAndErrorHandlingReactiveForm]="form" [form]="scriptForm">
  <p-dialog [modal]="true" header="Header" [(visible)]="isLinkDialogVisible" [breakpoints]="{'960px': '75vw'}" [style]="{width: '50vw'}" [baseZIndex]="10000"
            [draggable]="false" [resizable]="false">
    <div class="row" (keyup.enter)="addLink()">
      <div class="col-12">
        <ts-text-box ngDefaultControl label="Link" formControlName="link"
                     [defaultValue]="form.value.link"
                     [pattern]="urlPattern">

        </ts-text-box>
      </div>
      <div class="col-12">
        <ts-text-box ngDefaultControl formControlName="linkName"></ts-text-box>
      </div>
    </div>
    <ng-template pTemplate="footer">
      <ts-button value="Send" *ngIf="form.value.link; else closeButton" [disabled]="!validLink" (click)="addLink()"></ts-button>
      <ng-template #closeButton>
        <ts-button value="Close" mode="secondary" (click)="isLinkDialogVisible = false"></ts-button>
      </ng-template>
    </ng-template>
  </p-dialog>

  <div class="col-12">
    <p class="subtitle">Scripts</p>
    <div class="row mb-4">
      <div class="col-4 d-flex flex-column">
        <ts-text-box ngDefaultControl [defaultValue]="form.value.description" label="Title"  formControlName="description" required></ts-text-box>
      </div>
    </div>
    <label for="script" class="mb-2">Message</label>
    <ng-container formArrayName="scripts">
      <div class="row mb-5"  *ngFor="let _ of scripts.controls; index as i">
      <div class="col-8 d-flex flex-column">
        <div  contenteditable
              propValueAccessor="innerHTML"
              [id]="'script-' + i"
              [formControlName]="i"
              class="campaign-script-cmp-script-contenteditable"
              (keyup)="getCaretPositionInScriptEditable(script)"
              (click)="getCaretPositionInScriptEditable(script)"
              required #script>
        </div>
        <div class="col-12 mt-2 position-relative">
          <ts-icon type="emoji" class="ms-2" (click)="isEmojiVisible[i] = !isEmojiVisible[i]"></ts-icon>
          <ts-icon type="link" class="ms-2" (click)="showAddLink(script)"></ts-icon>
          <emoji-mart  [darkMode]="false" class="create-campaing-script-cmp-emoji-mart" *ngIf="isEmojiVisible[i]" (emojiSelect)="addEmoji($event, script, i)"></emoji-mart>
        </div>
      </div>
      <div class="col-4 d-flex align-items-baseline justify-content-start flex-wrap">
        <button type="button" class="btn btn-outline-primary me-3 border-rounded" (click)="pasteHtmlAtScriptEditable('<h1>Hola mundo</h1>', script)" >{{'{firstName}'}}</button>
        <button type="button" class="btn btn-outline-primary me-3 border-rounded">{{'{lastName}'}}</button>
        <button type="button" class="btn btn-outline-primary me-3 border-rounded">{{'{texterFirstName}'}}</button>
        <button type="button" class="btn btn-outline-primary me-3 border-rounded">{{'{texterLastName}'}}</button>
        <button type="button" class="btn btn-outline-primary me-3 border-rounded">{{'{cell}'}}</button>
        <button type="button" class="btn btn-outline-primary me-3 border-rounded">{{'{zip}'}}</button>
      </div>
      <div class="col-12 border-top mt-4 d-flex align-items-center pt-4">
        <div class="cursor-pointer">
          <ts-icon [bold]="true" type="add" color="blue-5" class="mt-2"></ts-icon>
          <span class="text-color-blue-5 font-weight-5 ms-1">New Script</span>
        </div>
      </div>
    </div>
    </ng-container>
    <p class="subtitle mb-5 pt-5">Replies</p>
    <div class="row mb-5">
      <div class="d-flex align-items-center">
        <p-checkbox formControlName="allowReplies" inputId="allowReplies"></p-checkbox>
        <label class="ms-3 font-weight-5 text-color-black" for="allowReplies">Allow Replies</label>
      </div>
      <div class="col-12 border-top mt-4 d-flex align-items-center pt-4">
        <div class="cursor-pointer">
          <ts-icon [bold]="true" type="add" color="blue-5" class="mt-2"></ts-icon>
          <span class="text-color-blue-5 font-weight-5 ms-1">New Recommended Reply</span>
        </div>
      </div>
    </div>
    <p class="subtitle mb-5 pt-5">Unsubscribe Message</p>
    <div class="row">
      <div class="d-flex align-items-center mb-5 pb-2">
        <p-checkbox formControlName="sendAutoReplyUnsubscribe" inputId="sendAutoReplyUnsubscribe"></p-checkbox>
        <label class="ms-3 font-weight-3 text-color-black" for="sendAutoReplyUnsubscribe">Send an autoreply message when a contact unsubscribes</label>
      </div>
      <div class="d-flex flex-column col-8">
        <label for="unsubscribeMessage" class="mb-2">Message</label>
        <textarea [rows]="7" [cols]="30"  id="unsubscribeMessage" formControlName="unsubscribeMessage" pInputTextarea minlength="4" autoResize="autoResize"></textarea>
      </div>
    </div>
    <div class="d-flex mt-5 align-items-center">
      <ts-button  type="submit" class="me-3" value="Save and Continue"></ts-button>
      <ts-button  type="submit" mode="secondary" value="Send Test Message"></ts-button>
    </div>
  </div>
</form>

